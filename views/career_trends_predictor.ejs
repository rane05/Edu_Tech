<%- include('layouts/header'); %>
    <%- include('layouts/navbar'); %>

        <style>
            :root {
                --color-primary: #FFB800;
                --color-secondary: #00A8FF;
                --color-dark: #1A1A2E;
                --color-text: #2D3748;
                --color-text-light: #718096;
                --color-bg: #FFFFFF;
                --color-bg-light: #F7FAFC;
            }

            * {
                margin: 0;
                padding: 0;
                box-sizing: border-box;
            }

            body {
                font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
                color: var(--color-text);
                background: var(--color-bg-light);
            }

            .page-wrapper {
                padding: 100px 20px 60px;
                min-height: 100vh;
            }

            .container {
                max-width: 1400px;
                margin: 0 auto;
            }

            /* Header */
            .page-header {
                text-align: center;
                margin-bottom: 60px;
            }

            .page-header h1 {
                font-size: clamp(2.5rem, 5vw, 3.5rem);
                font-weight: 700;
                color: var(--color-dark);
                margin-bottom: 15px;
            }

            .page-header p {
                font-size: 1.25rem;
                color: var(--color-text-light);
                max-width: 700px;
                margin: 0 auto;
            }

            /* Main Grid */
            .main-grid {
                display: grid;
                grid-template-columns: 450px 1fr;
                gap: 40px;
                align-items: start;
            }

            /* Form Section */
            .form-card {
                background: white;
                padding: 40px;
                border-radius: 20px;
                box-shadow: 0 10px 40px rgba(0, 0, 0, 0.08);
                position: sticky;
                top: 100px;
            }

            .form-card h2 {
                font-size: 1.75rem;
                font-weight: 700;
                color: var(--color-dark);
                margin-bottom: 30px;
                display: flex;
                align-items: center;
                gap: 12px;
            }

            .form-group {
                margin-bottom: 24px;
            }

            .form-group label {
                display: block;
                font-weight: 600;
                color: var(--color-text);
                margin-bottom: 8px;
                font-size: 0.95rem;
            }

            .form-group select,
            .form-group input[type="text"] {
                width: 100%;
                padding: 14px 18px;
                border: 2px solid #E2E8F0;
                border-radius: 12px;
                font-size: 1rem;
                transition: all 0.3s;
                background: white;
                color: var(--color-text);
            }

            .form-group select:focus,
            .form-group input[type="text"]:focus {
                outline: none;
                border-color: var(--color-secondary);
                box-shadow: 0 0 0 3px rgba(0, 168, 255, 0.1);
            }

            /* Skills Section */
            .skills-display {
                display: flex;
                flex-wrap: wrap;
                gap: 10px;
                margin-bottom: 12px;
                min-height: 40px;
            }

            .skill-tag {
                background: linear-gradient(135deg, var(--color-primary), var(--color-secondary));
                color: white;
                padding: 8px 16px;
                border-radius: 20px;
                display: flex;
                align-items: center;
                gap: 8px;
                font-size: 0.9rem;
                font-weight: 500;
                animation: slideIn 0.3s ease;
            }

            @keyframes slideIn {
                from {
                    opacity: 0;
                    transform: translateY(-10px);
                }

                to {
                    opacity: 1;
                    transform: translateY(0);
                }
            }

            .skill-tag button {
                background: rgba(255, 255, 255, 0.2);
                border: none;
                color: white;
                width: 20px;
                height: 20px;
                border-radius: 50%;
                cursor: pointer;
                display: flex;
                align-items: center;
                justify-content: center;
                font-size: 14px;
                transition: all 0.2s;
            }

            .skill-tag button:hover {
                background: rgba(255, 255, 255, 0.3);
            }

            .skill-input-group {
                display: flex;
                gap: 10px;
            }

            .skill-input-group input {
                flex: 1;
            }

            .add-skill-btn {
                background: var(--color-primary);
                color: white;
                border: none;
                padding: 14px 24px;
                border-radius: 12px;
                font-weight: 600;
                cursor: pointer;
                transition: all 0.3s;
                font-size: 1.1rem;
            }

            .add-skill-btn:hover {
                background: #E5A700;
                transform: translateY(-2px);
            }

            /* Analyze Button */
            .analyze-btn {
                width: 100%;
                background: linear-gradient(135deg, var(--color-secondary), #0095E8);
                color: white;
                border: none;
                padding: 16px;
                border-radius: 12px;
                font-size: 1.1rem;
                font-weight: 600;
                cursor: pointer;
                transition: all 0.3s;
                margin-top: 30px;
            }

            .analyze-btn:hover:not(:disabled) {
                transform: translateY(-3px);
                box-shadow: 0 10px 30px rgba(0, 168, 255, 0.3);
            }

            .analyze-btn:disabled {
                opacity: 0.6;
                cursor: not-allowed;
            }

            /* Results Section */
            .results-wrapper {
                display: none;
            }

            .results-wrapper.show {
                display: block;
                animation: fadeIn 0.5s ease;
            }

            @keyframes fadeIn {
                from {
                    opacity: 0;
                    transform: translateY(20px);
                }

                to {
                    opacity: 1;
                    transform: translateY(0);
                }
            }

            /* Loading State */
            .loading-state {
                background: white;
                padding: 60px;
                border-radius: 20px;
                box-shadow: 0 10px 40px rgba(0, 0, 0, 0.08);
                text-align: center;
            }

            .spinner {
                width: 50px;
                height: 50px;
                border: 4px solid #E2E8F0;
                border-top-color: var(--color-secondary);
                border-radius: 50%;
                animation: spin 1s linear infinite;
                margin: 0 auto 20px;
            }

            @keyframes spin {
                to {
                    transform: rotate(360deg);
                }
            }

            .loading-state h3 {
                font-size: 1.5rem;
                color: var(--color-dark);
                margin-bottom: 8px;
            }

            .loading-state p {
                color: var(--color-text-light);
            }

            /* Results Content */
            .results-content {
                display: none;
            }

            .results-content.show {
                display: block;
            }

            .section-title {
                font-size: 2rem;
                font-weight: 700;
                color: var(--color-dark);
                margin-bottom: 30px;
            }

            .results-grid {
                display: grid;
                gap: 30px;
            }

            /* Career Cards */
            .career-card {
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                padding: 35px;
                border-radius: 20px;
                box-shadow: 0 15px 40px rgba(102, 126, 234, 0.3);
                color: white;
            }

            .career-card h3 {
                font-size: 1.75rem;
                margin-bottom: 25px;
            }

            .career-item {
                background: rgba(255, 255, 255, 0.15);
                backdrop-filter: blur(10px);
                padding: 20px;
                border-radius: 15px;
                margin-bottom: 15px;
            }

            .career-item h4 {
                font-size: 1.25rem;
                margin-bottom: 10px;
            }

            .career-item p {
                opacity: 0.9;
                margin-bottom: 12px;
            }

            .career-stats {
                display: flex;
                flex-wrap: wrap;
                gap: 10px;
                margin-top: 12px;
            }

            .stat-badge {
                background: rgba(255, 255, 255, 0.2);
                padding: 8px 16px;
                border-radius: 20px;
                font-size: 0.9rem;
                font-weight: 500;
            }

            /* Chart Card */
            .chart-card {
                background: white;
                padding: 35px;
                border-radius: 20px;
                box-shadow: 0 10px 40px rgba(0, 0, 0, 0.08);
            }

            .chart-card h3 {
                font-size: 1.5rem;
                font-weight: 700;
                color: var(--color-dark);
                margin-bottom: 25px;
            }

            .chart-container {
                position: relative;
                height: 350px;
            }

            /* Recommendations */
            .recommendations-card {
                background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
                padding: 35px;
                border-radius: 20px;
                box-shadow: 0 15px 40px rgba(79, 172, 254, 0.3);
                color: white;
            }

            .recommendations-card h3 {
                font-size: 1.75rem;
                margin-bottom: 25px;
            }

            .recommendation-item {
                background: rgba(255, 255, 255, 0.15);
                backdrop-filter: blur(10px);
                padding: 20px;
                border-radius: 15px;
                margin-bottom: 15px;
                border-left: 4px solid rgba(255, 255, 255, 0.5);
            }

            .recommendation-item.priority-high {
                border-left-color: #FFB800;
            }

            .recommendation-item h4 {
                font-size: 1.2rem;
                margin-bottom: 8px;
            }

            .recommendation-item strong {
                opacity: 0.9;
            }

            /* Market Insights */
            .insights-card {
                background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);
                padding: 35px;
                border-radius: 20px;
                box-shadow: 0 15px 40px rgba(168, 237, 234, 0.3);
            }

            .insights-card h3 {
                font-size: 1.75rem;
                color: var(--color-dark);
                margin-bottom: 25px;
            }

            .insight-item {
                background: rgba(255, 255, 255, 0.5);
                backdrop-filter: blur(10px);
                padding: 20px;
                border-radius: 15px;
                margin-bottom: 15px;
            }

            .insight-item h4 {
                font-size: 1.2rem;
                color: var(--color-dark);
                margin-bottom: 8px;
            }

            .insight-item p {
                color: var(--color-text);
            }

            /* Responsive */
            @media (max-width: 1200px) {
                .main-grid {
                    grid-template-columns: 1fr;
                }

                .form-card {
                    position: relative;
                    top: 0;
                }

                .chart-container {
                    height: 300px;
                }
            }

            @media (max-width: 768px) {
                .page-wrapper {
                    padding: 90px 15px 40px;
                }

                .page-header h1 {
                    font-size: 2rem;
                }

                .form-card {
                    padding: 25px;
                }

                .career-card,
                .chart-card,
                .recommendations-card,
                .insights-card {
                    padding: 25px;
                }
            }
        </style>

        <div class="page-wrapper">
            <div class="container">
                <!-- Header -->
                <div class="page-header">
                    <h1>üîÆ AI Career Trends Predictor</h1>
                    <p>Discover emerging opportunities and plan your future with AI-powered insights</p>
                </div>

                <!-- Main Content -->
                <div class="main-grid">
                    <!-- Input Form -->
                    <div class="form-card">
                        <h2>üìä Your Profile</h2>
                        <form id="careerForm">
                            <div class="form-group">
                                <label for="interests">Primary Interest</label>
                                <select id="interests" name="interests" required>
                                    <option value="">Select your interest</option>
                                    <option value="technology">Technology & Innovation</option>
                                    <option value="healthcare">Healthcare & Medicine</option>
                                    <option value="business">Business & Management</option>
                                    <option value="arts">Arts & Creative</option>
                                    <option value="science">Science & Research</option>
                                    <option value="education">Education & Training</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label>Your Skills</label>
                                <div class="skills-display" id="skillsDisplay"></div>
                                <div class="skill-input-group">
                                    <input type="text" id="skillInput" placeholder="Add a skill...">
                                    <button type="button" class="add-skill-btn" onclick="addSkill()">+</button>
                                </div>
                            </div>

                            <div class="form-group">
                                <label for="location">Preferred Location</label>
                                <input type="text" id="location" name="location" placeholder="City, State, or Country">
                            </div>

                            <div class="form-group">
                                <label for="educationLevel">Education Level</label>
                                <select id="educationLevel" name="educationLevel" required>
                                    <option value="">Select level</option>
                                    <option value="high-school">High School</option>
                                    <option value="bachelors">Bachelor's Degree</option>
                                    <option value="masters">Master's Degree</option>
                                    <option value="phd">PhD/Doctorate</option>
                                    <option value="certification">Professional Certification</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label for="timeHorizon">Planning Timeframe</label>
                                <select id="timeHorizon" name="timeHorizon" required>
                                    <option value="">Select timeframe</option>
                                    <option value="1-3 years">1-3 years</option>
                                    <option value="3-5 years">3-5 years</option>
                                    <option value="5-10 years">5-10 years</option>
                                    <option value="10+ years">10+ years</option>
                                </select>
                            </div>

                            <button type="submit" class="analyze-btn" id="analyzeBtn">
                                üîÆ Analyze Career Trends
                            </button>
                        </form>
                    </div>

                    <!-- Results Section -->
                    <div class="results-wrapper" id="resultsWrapper">
                        <!-- Loading State -->
                        <div class="loading-state" id="loadingState">
                            <div class="spinner"></div>
                            <h3>AI is analyzing trends...</h3>
                            <p>Processing your career profile</p>
                        </div>

                        <!-- Results Content -->
                        <div class="results-content" id="resultsContent">
                            <!-- Results populated by JavaScript -->
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
        <script>
            let userSkills = [];
            let growthChart = null;
            let demandChart = null;

            function addSkill() {
                const input = document.getElementById('skillInput');
                const skill = input.value.trim();

                if (skill && !userSkills.includes(skill)) {
                    userSkills.push(skill);
                    input.value = '';
                    renderSkills();
                }
            }

            function removeSkill(skill) {
                userSkills = userSkills.filter(s => s !== skill);
                renderSkills();
            }

            function renderSkills() {
                const container = document.getElementById('skillsDisplay');
                container.innerHTML = userSkills.map(skill => `
            <div class="skill-tag">
                ${skill}
                <button onclick="removeSkill('${skill}')">&times;</button>
            </div>
        `).join('');
            }

            document.getElementById('careerForm').addEventListener('submit', async (e) => {
                e.preventDefault();

                const formData = new FormData(e.target);
                const data = {
                    interests: formData.get('interests'),
                    skills: userSkills,
                    location: formData.get('location'),
                    educationLevel: formData.get('educationLevel'),
                    timeHorizon: formData.get('timeHorizon')
                };

                // Show loading
                document.getElementById('resultsWrapper').classList.add('show');
                document.getElementById('loadingState').style.display = 'block';
                document.getElementById('resultsContent').classList.remove('show');
                document.getElementById('analyzeBtn').disabled = true;

                try {
                    const response = await fetch('/api/career-trends/analyze', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify(data)
                    });

                    const result = await response.json();

                    if (result.success) {
                        displayResults(result);
                    } else {
                        throw new Error(result.error);
                    }
                } catch (error) {
                    console.error('Error:', error);
                    document.getElementById('resultsContent').innerHTML = `
                <div style="background: white; padding: 40px; border-radius: 20px; text-align: center;">
                    <h3 style="color: #e74c3c; margin-bottom: 10px;">‚ùå Analysis Failed</h3>
                    <p style="color: #718096;">${error.message || 'Please try again later.'}</p>
                </div>
            `;
                } finally {
                    document.getElementById('loadingState').style.display = 'none';
                    document.getElementById('resultsContent').classList.add('show');
                    document.getElementById('analyzeBtn').disabled = false;
                }
            });

            function displayResults(result) {
                const { trends, recommendations, marketInsights } = result;

                document.getElementById('resultsContent').innerHTML = `
            <h2 class="section-title">üéØ Your Career Analysis</h2>
            <div class="results-grid">
                <!-- Emerging Careers -->
                <div class="career-card">
                    <h3>üöÄ Emerging Career Opportunities</h3>
                    ${trends.emergingCareers.map(career => `
                        <div class="career-item">
                            <h4>${career.title}</h4>
                            <p>Key Skills: ${career.skills.join(', ')}</p>
                            <div class="career-stats">
                                <span class="stat-badge">üìà ${career.growthRate}% Growth</span>
                                <span class="stat-badge">üí∞ ${career.salaryRange}</span>
                                <span class="stat-badge">üî• ${career.demand} Demand</span>
                            </div>
                        </div>
                    `).join('')}
                </div>

                <!-- Growth Chart -->
                <div class="chart-card">
                    <h3>üìä Career Growth Projection</h3>
                    <div class="chart-container">
                        <canvas id="growthChart"></canvas>
                    </div>
                </div>

                <!-- Skills Demand Chart -->
                <div class="chart-card">
                    <h3>üéØ Skills Demand Analysis</h3>
                    <div class="chart-container">
                        <canvas id="demandChart"></canvas>
                    </div>
                </div>

                <!-- Recommendations -->
                <div class="recommendations-card">
                    <h3>üí° AI Recommendations</h3>
                    ${recommendations.map(rec => `
                        <div class="recommendation-item priority-${rec.priority.toLowerCase()}">
                            <h4>${rec.title}</h4>
                            <p>${rec.description}</p>
                            <p><strong>Action:</strong> ${rec.action}</p>
                        </div>
                    `).join('')}
                </div>

                <!-- Market Insights -->
                <div class="insights-card">
                    <h3>üåç Market Insights</h3>
                    <div class="insight-item">
                        <h4>Local Market</h4>
                        <p>${marketInsights.localMarket}</p>
                    </div>
                    <div class="insight-item">
                        <h4>Regional Trends</h4>
                        <p>${marketInsights.regionalTrends}</p>
                    </div>
                    ${marketInsights.futurePrediction ? `
                        <div class="insight-item">
                            <h4>Future Prediction</h4>
                            <p>${marketInsights.futurePrediction}</p>
                        </div>
                    ` : ''}
                </div>
            </div>
        `;

                // Create charts after DOM is updated
                setTimeout(() => {
                    createGrowthChart(trends.emergingCareers);
                    createDemandChart(trends.skillDemand);
                }, 100);
            }

            function createGrowthChart(careers) {
                const ctx = document.getElementById('growthChart');
                if (!ctx) return;

                if (growthChart) {
                    growthChart.destroy();
                }

                growthChart = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: careers.map(c => c.title),
                        datasets: [{
                            label: 'Growth Rate (%)',
                            data: careers.map(c => c.growthRate),
                            backgroundColor: 'rgba(0, 168, 255, 0.7)',
                            borderColor: 'rgba(0, 168, 255, 1)',
                            borderWidth: 2,
                            borderRadius: 8
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                display: false
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                title: {
                                    display: true,
                                    text: 'Growth Rate (%)'
                                }
                            }
                        }
                    }
                });
            }

            function createDemandChart(skills) {
                const ctx = document.getElementById('demandChart');
                if (!ctx) return;

                if (demandChart) {
                    demandChart.destroy();
                }

                demandChart = new Chart(ctx, {
                    type: 'radar',
                    data: {
                        labels: skills.map(s => s.skill),
                        datasets: [{
                            label: 'Demand Level',
                            data: skills.map(s => {
                                const demand = s.demand.toLowerCase();
                                if (demand.includes('very high')) return 5;
                                if (demand.includes('high')) return 4;
                                if (demand.includes('medium')) return 3;
                                if (demand.includes('low')) return 2;
                                return 1;
                            }),
                            backgroundColor: 'rgba(255, 184, 0, 0.2)',
                            borderColor: 'rgba(255, 184, 0, 1)',
                            borderWidth: 2,
                            pointBackgroundColor: 'rgba(255, 184, 0, 1)'
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            r: {
                                beginAtZero: true,
                                max: 5,
                                ticks: {
                                    stepSize: 1
                                }
                            }
                        },
                        plugins: {
                            legend: {
                                display: false
                            }
                        }
                    }
                });
            }

            // Allow Enter key to add skills
            document.getElementById('skillInput').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    addSkill();
                }
            });

            renderSkills();
        </script>

        <%- include('layouts/footer'); %>