<%- include('layouts/header'); %>
    <%- include('layouts/navbar'); %>

        <style>
            :root {
                --primary: #4F46E5;
                --secondary: #10B981;
                --accent: #F59E0B;
                --bg: #F9FAFB;
                --text: #1F2937;
            }

            body {
                background: var(--bg);
                font-family: 'Inter', sans-serif;
            }

            .builder-container {
                display: flex;
                gap: 20px;
                max-width: 1800px;
                margin: 100px auto 40px;
                padding: 0 20px;
            }

            /* Left Panel - Form */
            .form-panel {
                flex: 1;
                max-width: 600px;
                background: white;
                border-radius: 12px;
                box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
                padding: 30px;
                height: fit-content;
                max-height: calc(100vh - 140px);
                overflow-y: auto;
            }

            .form-panel h2 {
                font-size: 24px;
                margin-bottom: 24px;
                color: var(--text);
            }

            .form-section {
                margin-bottom: 32px;
                padding-bottom: 32px;
                border-bottom: 1px solid #E5E7EB;
            }

            .form-section:last-child {
                border-bottom: none;
            }

            .section-title {
                font-size: 18px;
                font-weight: 600;
                margin-bottom: 16px;
                color: var(--primary);
            }

            .form-group {
                margin-bottom: 16px;
            }

            .form-label {
                display: block;
                font-size: 14px;
                font-weight: 500;
                margin-bottom: 6px;
                color: #374151;
            }

            .form-input,
            .form-textarea {
                width: 100%;
                padding: 10px 12px;
                border: 1px solid #D1D5DB;
                border-radius: 6px;
                font-size: 14px;
                transition: all 0.2s;
            }

            .form-input:focus,
            .form-textarea:focus {
                outline: none;
                border-color: var(--primary);
                box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.1);
            }

            .form-textarea {
                resize: vertical;
                min-height: 80px;
            }

            .add-entry-btn {
                background: #F3F4F6;
                border: 1px dashed #9CA3AF;
                padding: 10px 16px;
                border-radius: 6px;
                font-size: 14px;
                cursor: pointer;
                transition: all 0.2s;
                width: 100%;
                margin-top: 12px;
            }

            .add-entry-btn:hover {
                background: #E5E7EB;
                border-color: #6B7280;
            }

            .entry-item {
                background: #F9FAFB;
                padding: 16px;
                border-radius: 8px;
                margin-bottom: 12px;
                position: relative;
            }

            .remove-entry {
                position: absolute;
                top: 12px;
                right: 12px;
                background: #EF4444;
                color: white;
                border: none;
                width: 24px;
                height: 24px;
                border-radius: 50%;
                cursor: pointer;
                font-size: 14px;
                line-height: 1;
            }

            .skills-container {
                display: flex;
                flex-wrap: wrap;
                gap: 8px;
                margin-top: 8px;
            }

            .skill-tag {
                background: var(--primary);
                color: white;
                padding: 6px 12px;
                border-radius: 20px;
                font-size: 13px;
                display: flex;
                align-items: center;
                gap: 6px;
            }

            .skill-tag button {
                background: none;
                border: none;
                color: white;
                cursor: pointer;
                padding: 0;
                font-size: 16px;
                line-height: 1;
            }

            /* Right Panel - Preview */
            .preview-panel {
                flex: 1;
                max-width: 800px;
                position: sticky;
                top: 100px;
                height: fit-content;
            }

            .preview-controls {
                background: white;
                padding: 16px 20px;
                border-radius: 8px;
                margin-bottom: 16px;
                display: flex;
                gap: 12px;
                align-items: center;
                box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            }

            .template-select {
                padding: 8px 12px;
                border: 1px solid #D1D5DB;
                border-radius: 6px;
                font-size: 14px;
            }

            .btn {
                padding: 8px 16px;
                border-radius: 6px;
                font-size: 14px;
                font-weight: 500;
                cursor: pointer;
                transition: all 0.2s;
                border: none;
            }

            .btn-primary {
                background: var(--primary);
                color: white;
            }

            .btn-primary:hover {
                background: #4338CA;
            }

            .btn-secondary {
                background: var(--secondary);
                color: white;
            }

            .btn-secondary:hover {
                background: #059669;
            }

            .preview-paper {
                background: white;
                padding: 40px;
                border-radius: 8px;
                box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
                min-height: 800px;
            }

            /* Resume Templates */
            .resume-template {
                font-family: 'Inter', sans-serif;
                color: #1F2937;
                line-height: 1.6;
            }

            .resume-header {
                text-align: center;
                padding-bottom: 20px;
                border-bottom: 2px solid #E5E7EB;
                margin-bottom: 24px;
            }

            .resume-name {
                font-size: 32px;
                font-weight: 700;
                margin-bottom: 8px;
                color: var(--primary);
            }

            .resume-contact {
                font-size: 14px;
                color: #6B7280;
                display: flex;
                justify-content: center;
                gap: 16px;
                flex-wrap: wrap;
            }

            .resume-section {
                margin-bottom: 24px;
            }

            .resume-section-title {
                font-size: 18px;
                font-weight: 600;
                color: var(--primary);
                margin-bottom: 12px;
                padding-bottom: 6px;
                border-bottom: 2px solid var(--primary);
            }

            .resume-entry {
                margin-bottom: 16px;
            }

            .entry-header {
                display: flex;
                justify-content: space-between;
                margin-bottom: 4px;
            }

            .entry-title {
                font-weight: 600;
                font-size: 16px;
            }

            .entry-date {
                font-size: 14px;
                color: #6B7280;
            }

            .entry-subtitle {
                color: #6B7280;
                font-size: 14px;
                margin-bottom: 8px;
            }

            .entry-description {
                font-size: 14px;
                color: #4B5563;
            }

            .skills-grid {
                display: flex;
                flex-wrap: wrap;
                gap: 8px;
            }

            .skill-badge {
                background: #EEF2FF;
                color: var(--primary);
                padding: 6px 12px;
                border-radius: 4px;
                font-size: 13px;
                font-weight: 500;
            }

            @media print {
                body {
                    background: white;
                }

                .form-panel,
                .preview-controls {
                    display: none !important;
                }

                .builder-container {
                    margin: 0;
                    padding: 0;
                }

                .preview-panel {
                    max-width: 100%;
                }

                .preview-paper {
                    box-shadow: none;
                    padding: 0;
                }
            }
        </style>

        <div class="builder-container">
            <!-- Form Panel -->
            <div class="form-panel">
                <h2>Build Your Resume</h2>

                <!-- Personal Information -->
                <div class="form-section">
                    <div class="section-title">Personal Information</div>
                    <div class="form-group">
                        <label class="form-label">Full Name</label>
                        <input type="text" id="fullName" class="form-input" placeholder="John Doe"
                            value="<%= user.name !== 'Guest' ? user.name : '' %>">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Email</label>
                        <input type="email" id="email" class="form-input" placeholder="john@example.com">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Phone</label>
                        <input type="tel" id="phone" class="form-input" placeholder="+91 9876543210">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Location</label>
                        <input type="text" id="location" class="form-input" placeholder="Mumbai, India">
                    </div>
                    <div class="form-group">
                        <label class="form-label">LinkedIn URL (Optional)</label>
                        <input type="url" id="linkedin" class="form-input" placeholder="linkedin.com/in/johndoe">
                    </div>
                </div>

                <!-- Professional Summary -->
                <div class="form-section">
                    <div class="section-title">Professional Summary</div>
                    <textarea id="summary" class="form-textarea"
                        placeholder="Brief professional summary highlighting your key strengths and career objectives..."></textarea>
                </div>

                <!-- Work Experience -->
                <div class="form-section">
                    <div class="section-title">Work Experience</div>
                    <div id="experienceContainer"></div>
                    <button class="add-entry-btn" onclick="addExperience()">+ Add Experience</button>
                </div>

                <!-- Education -->
                <div class="form-section">
                    <div class="section-title">Education</div>
                    <div id="educationContainer"></div>
                    <button class="add-entry-btn" onclick="addEducation()">+ Add Education</button>
                </div>

                <!-- Skills -->
                <div class="form-section">
                    <div class="section-title">Skills</div>
                    <div class="form-group">
                        <input type="text" id="skillInput" class="form-input"
                            placeholder="Type a skill and press Enter">
                        <div class="skills-container" id="skillsContainer"></div>
                    </div>
                </div>

                <!-- Projects -->
                <div class="form-section">
                    <div class="section-title">Projects</div>
                    <div id="projectsContainer"></div>
                    <button class="add-entry-btn" onclick="addProject()">+ Add Project</button>
                </div>
            </div>

            <!-- Preview Panel -->
            <div class="preview-panel">
                <div class="preview-controls">
                    <label>Template:</label>
                    <select class="template-select" id="templateSelect" onchange="updatePreview()">
                        <option value="modern">Modern Professional</option>
                        <option value="classic">Classic Elegant</option>
                        <option value="minimal">Minimal Tech</option>
                    </select>
                    <button class="btn btn-primary" onclick="window.print()">
                        <i class="fas fa-download"></i> Download PDF
                    </button>
                </div>

                <div class="preview-paper" id="resumePreview">
                    <!-- Preview will be generated here -->
                </div>
            </div>
        </div>

        <script>
            let experienceCount = 0;
            let educationCount = 0;
            let projectCount = 0;
            let skills = [];

            // Initialize
            document.addEventListener('DOMContentLoaded', function () {
                addExperience();
                addEducation();
                updatePreview();

                // Auto-update on any input change
                document.querySelectorAll('input, textarea').forEach(el => {
                    el.addEventListener('input', updatePreview);
                });

                // Skills input handler
                document.getElementById('skillInput').addEventListener('keypress', function (e) {
                    if (e.key === 'Enter') {
                        addSkill(this.value.trim());
                        this.value = '';
                        e.preventDefault();
                    }
                });
            });

            function addExperience() {
                experienceCount++;
                const container = document.getElementById('experienceContainer');
                const div = document.createElement('div');
                div.className = 'entry-item';
                div.id = `exp-${experienceCount}`;
                div.innerHTML = `
        <button class="remove-entry" onclick="removeEntry('exp-${experienceCount}')">×</button>
        <div class="form-group">
            <input type="text" class="form-input exp-title" placeholder="Job Title">
        </div>
        <div class="form-group">
            <input type="text" class="form-input exp-company" placeholder="Company Name">
        </div>
        <div class="form-group">
            <input type="text" class="form-input exp-duration" placeholder="Jan 2020 - Present">
        </div>
        <div class="form-group">
            <textarea class="form-textarea exp-description" placeholder="Key responsibilities and achievements..."></textarea>
        </div>
    `;
                container.appendChild(div);
                div.querySelectorAll('input, textarea').forEach(el => {
                    el.addEventListener('input', updatePreview);
                });
            }

            function addEducation() {
                educationCount++;
                const container = document.getElementById('educationContainer');
                const div = document.createElement('div');
                div.className = 'entry-item';
                div.id = `edu-${educationCount}`;
                div.innerHTML = `
        <button class="remove-entry" onclick="removeEntry('edu-${educationCount}')">×</button>
        <div class="form-group">
            <input type="text" class="form-input edu-degree" placeholder="Degree (e.g., B.Tech in Computer Science)">
        </div>
        <div class="form-group">
            <input type="text" class="form-input edu-institution" placeholder="Institution Name">
        </div>
        <div class="form-group">
            <input type="text" class="form-input edu-year" placeholder="2018 - 2022">
        </div>
        <div class="form-group">
            <input type="text" class="form-input edu-grade" placeholder="CGPA/Percentage (Optional)">
        </div>
    `;
                container.appendChild(div);
                div.querySelectorAll('input').forEach(el => {
                    el.addEventListener('input', updatePreview);
                });
            }

            function addProject() {
                projectCount++;
                const container = document.getElementById('projectsContainer');
                const div = document.createElement('div');
                div.className = 'entry-item';
                div.id = `proj-${projectCount}`;
                div.innerHTML = `
        <button class="remove-entry" onclick="removeEntry('proj-${projectCount}')">×</button>
        <div class="form-group">
            <input type="text" class="form-input proj-title" placeholder="Project Title">
        </div>
        <div class="form-group">
            <textarea class="form-textarea proj-description" placeholder="Project description and technologies used..."></textarea>
        </div>
    `;
                container.appendChild(div);
                div.querySelectorAll('input, textarea').forEach(el => {
                    el.addEventListener('input', updatePreview);
                });
            }

            function removeEntry(id) {
                document.getElementById(id).remove();
                updatePreview();
            }

            function addSkill(skill) {
                if (skill && !skills.includes(skill)) {
                    skills.push(skill);
                    renderSkills();
                    updatePreview();
                }
            }

            function removeSkill(skill) {
                skills = skills.filter(s => s !== skill);
                renderSkills();
                updatePreview();
            }

            function renderSkills() {
                const container = document.getElementById('skillsContainer');
                container.innerHTML = skills.map(skill => `
        <div class="skill-tag">
            ${skill}
            <button onclick="removeSkill('${skill}')">×</button>
        </div>
    `).join('');
            }

            function updatePreview() {
                const template = document.getElementById('templateSelect').value;
                const data = collectFormData();
                const html = generateResumeHTML(data, template);
                document.getElementById('resumePreview').innerHTML = html;
            }

            function collectFormData() {
                const data = {
                    name: document.getElementById('fullName').value,
                    email: document.getElementById('email').value,
                    phone: document.getElementById('phone').value,
                    location: document.getElementById('location').value,
                    linkedin: document.getElementById('linkedin').value,
                    summary: document.getElementById('summary').value,
                    skills: skills,
                    experience: [],
                    education: [],
                    projects: []
                };

                // Collect experience
                document.querySelectorAll('#experienceContainer .entry-item').forEach(item => {
                    data.experience.push({
                        title: item.querySelector('.exp-title').value,
                        company: item.querySelector('.exp-company').value,
                        duration: item.querySelector('.exp-duration').value,
                        description: item.querySelector('.exp-description').value
                    });
                });

                // Collect education
                document.querySelectorAll('#educationContainer .entry-item').forEach(item => {
                    data.education.push({
                        degree: item.querySelector('.edu-degree').value,
                        institution: item.querySelector('.edu-institution').value,
                        year: item.querySelector('.edu-year').value,
                        grade: item.querySelector('.edu-grade').value
                    });
                });

                // Collect projects
                document.querySelectorAll('#projectsContainer .entry-item').forEach(item => {
                    data.projects.push({
                        title: item.querySelector('.proj-title').value,
                        description: item.querySelector('.proj-description').value
                    });
                });

                return data;
            }

            function generateResumeHTML(data, template) {
                if (!data.name) {
                    return '<div style="text-align:center; color:#9CA3AF; padding:100px 0;">Fill in your details to see the preview</div>';
                }

                let html = '<div class="resume-template">';

                // Header
                html += `
        <div class="resume-header">
            <div class="resume-name">${data.name}</div>
            <div class="resume-contact">
                ${data.email ? `<span><i class="fas fa-envelope"></i> ${data.email}</span>` : ''}
                ${data.phone ? `<span><i class="fas fa-phone"></i> ${data.phone}</span>` : ''}
                ${data.location ? `<span><i class="fas fa-map-marker-alt"></i> ${data.location}</span>` : ''}
                ${data.linkedin ? `<span><i class="fab fa-linkedin"></i> LinkedIn</span>` : ''}
            </div>
        </div>
    `;

                // Summary
                if (data.summary) {
                    html += `
            <div class="resume-section">
                <div class="resume-section-title">Professional Summary</div>
                <p class="entry-description">${data.summary}</p>
            </div>
        `;
                }

                // Experience
                if (data.experience.length > 0 && data.experience[0].title) {
                    html += '<div class="resume-section"><div class="resume-section-title">Work Experience</div>';
                    data.experience.forEach(exp => {
                        if (exp.title || exp.company) {
                            html += `
                    <div class="resume-entry">
                        <div class="entry-header">
                            <div class="entry-title">${exp.title}</div>
                            <div class="entry-date">${exp.duration}</div>
                        </div>
                        <div class="entry-subtitle">${exp.company}</div>
                        <div class="entry-description">${exp.description}</div>
                    </div>
                `;
                        }
                    });
                    html += '</div>';
                }

                // Education
                if (data.education.length > 0 && data.education[0].degree) {
                    html += '<div class="resume-section"><div class="resume-section-title">Education</div>';
                    data.education.forEach(edu => {
                        if (edu.degree || edu.institution) {
                            html += `
                    <div class="resume-entry">
                        <div class="entry-header">
                            <div class="entry-title">${edu.degree}</div>
                            <div class="entry-date">${edu.year}</div>
                        </div>
                        <div class="entry-subtitle">${edu.institution}</div>
                        ${edu.grade ? `<div class="entry-description">${edu.grade}</div>` : ''}
                    </div>
                `;
                        }
                    });
                    html += '</div>';
                }

                // Skills
                if (data.skills.length > 0) {
                    html += `
            <div class="resume-section">
                <div class="resume-section-title">Skills</div>
                <div class="skills-grid">
                    ${data.skills.map(skill => `<div class="skill-badge">${skill}</div>`).join('')}
                </div>
            </div>
        `;
                }

                // Projects
                if (data.projects.length > 0 && data.projects[0].title) {
                    html += '<div class="resume-section"><div class="resume-section-title">Projects</div>';
                    data.projects.forEach(proj => {
                        if (proj.title) {
                            html += `
                    <div class="resume-entry">
                        <div class="entry-title">${proj.title}</div>
                        <div class="entry-description">${proj.description}</div>
                    </div>
                `;
                        }
                    });
                    html += '</div>';
                }

                html += '</div>';
                return html;
            }
        </script>

        <%- include('layouts/footer'); %>